@model BookSearchSystem.Web.Models.BookSearchViewModel
@{
    ViewData["Title"] = "Búsqueda de Libros";
}

<div class="container-fluid py-4">
    <div class="row">
        <div class="col-12">
            <h1 class="text-center mb-4 text-primary">
                <i class="fas fa-book-open me-2"></i>
                Sistema de Búsqueda de Libros
            </h1>
        </div>
    </div>

    <!-- Formulario de Búsqueda -->
    <div class="row justify-content-center mb-4">
        <div class="col-md-8 col-lg-6">
            <div class="card shadow-lg border-0 search-card">
                <div class="card-header bg-primary text-white text-center">
                    <h4 class="mb-0">
                        <i class="fas fa-search me-2"></i>
                        Buscar Libros por Autor
                    </h4>
                </div>
                <div class="card-body p-4">
                    <form asp-action="Search" method="post" id="searchForm">
                        @Html.AntiForgeryToken()
                        
                        <div class="mb-3">
                            <label asp-for="Author" class="form-label fw-bold">
                                <i class="fas fa-user-edit me-1"></i>
                                @Html.DisplayNameFor(m => m.Author)
                            </label>
                            <div class="input-group">
                                <span class="input-group-text bg-light">
                                    <i class="fas fa-feather-alt text-primary"></i>
                                </span>
                                <input asp-for="Author" 
                                       class="form-control form-control-lg" 
                                       placeholder="Ej: Gabriel García Márquez" 
                                       autocomplete="off"
                                       required />
                            </div>
                            <span asp-validation-for="Author" class="text-danger small"></span>
                        </div>
                        
                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-primary btn-lg" id="searchBtn">
                                <i class="fas fa-search me-2"></i>
                                Buscar Libros
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Navegación -->
    <div class="row mb-4">
        <div class="col-12 text-center">
            <a asp-action="History" class="btn btn-outline-secondary btn-lg me-2">
                <i class="fas fa-history me-2"></i>
                Ver Historial de Búsquedas
            </a>
        </div>
    </div>

    <!-- Resultados de Búsqueda -->
    @if (Model.ShowResults)
    {
        <div class="row">
            <div class="col-12">
                <div class="card shadow-lg border-0 results-card">
                    <div class="card-header @(Model.Success ? "bg-success" : "bg-warning") text-white">
                        <h4 class="mb-0">
                            <i class="fas @(Model.Success ? "fa-check-circle" : "fa-exclamation-triangle") me-2"></i>
                            Resultados de la Búsqueda
                        </h4>
                    </div>
                    <div class="card-body">
                        <!-- Mensaje de resultado -->
                        <div class="alert @(Model.Success ? "alert-success" : "alert-warning") mb-4">
                            <i class="fas @(Model.Success ? "fa-info-circle" : "fa-exclamation-triangle") me-2"></i>
                            @Model.Message
                        </div>

                        @if (Model.Success && Model.Books.Any())
                        {
                            <!-- Información de resultados -->
                            <div class="mb-3">
                                <span class="badge bg-primary fs-6">
                                    <i class="fas fa-book me-1"></i>
                                    @Model.TotalResults libro(s) encontrado(s)
                                </span>
                            </div>

                            <!-- Tabla de resultados -->
                            <div class="table-responsive">
                                <table class="table table-hover table-striped">
                                    <thead class="table-dark">
                                        <tr>
                                            <th scope="col">
                                                <i class="fas fa-book me-1"></i>
                                                Título
                                            </th>
                                            <th scope="col">
                                                <i class="fas fa-user me-1"></i>
                                                Autor(es)
                                            </th>
                                            <th scope="col">
                                                <i class="fas fa-calendar me-1"></i>
                                                Año de Publicación
                                            </th>
                                            <th scope="col">
                                                <i class="fas fa-building me-1"></i>
                                                Editorial(es)
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (var book in Model.Books)
                                        {
                                            <tr>
                                                <td class="fw-semibold text-primary">@book.Title</td>
                                                <td>@book.Authors</td>
                                                <td>
                                                    <span class="badge bg-secondary">@book.FirstPublishYear</span>
                                                </td>
                                                <td class="small">@book.Publishers</td>
                                            </tr>
                                        }
                                    </tbody>
                                </table>
                            </div>
                        }
                        else if (Model.Success && !Model.Books.Any())
                        {
                            <div class="text-center py-5">
                                <i class="fas fa-search fa-3x text-muted mb-3"></i>
                                <h5 class="text-muted">No se encontraron libros para este autor</h5>
                                <p class="text-muted">Intenta con otro nombre de autor</p>
                            </div>
                        }
                    </div>
                </div>
            </div>
        </div>
    }
</div>

@section Scripts {
    <script src="~/js/book-search.js" asp-append-version="true"></script>
    <script>
        $(document).ready(function() {
            // Funcionalidades específicas de la página de búsqueda
            console.log('Página de búsqueda cargada');
            
            // Mostrar ayuda contextual
            $('#Author').on('focus', function() {
                if ($(this).val().trim() === '') {
                    BookSearchUtils.showAlert && BookSearchUtils.showAlert('info', 
                        'Ingresa el nombre completo del autor para obtener mejores resultados', 3000);
                }
            });
        });
    </script>
}
